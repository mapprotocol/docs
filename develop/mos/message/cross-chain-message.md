# MAPO 全鏈服務 (MOS) 消息

MOS 消息使得建立在一條鏈上的項目可以方便地將一些項目信息同步到其他鏈上，也可以調用其他相連鏈上的合約方法。

MOS使用MAP Protocol輕客戶端對跨鏈消息的交易進行驗證，確保跨鏈消息的真實性和鏈上可查性。

使用 MOS，您可以實現與兩條鏈的互操作：

- 從鏈 A 調用鏈 B 上的合約。
- 將鏈A中的消息變化打包寫入鏈B，實現消息同步

##先決條件

- 應用程序必須在 MAP 協議支持的鏈之一上。 有關部署 MAPO 輕客戶端的鏈列表，請參閱[鏈名稱](https://docs.mapprotocol.io/develop/light-client)。 該列表會隨著新鏈的添加而更新。
- 跨鏈消息的可執行合約權限必須授權給對應鏈上的MOS合約。
- A 鍊和 B 鏈必須都部署了 MOS 消息合約（Near Chain 的 MOS 消息仍在開發中）。

## MOS如何完成跨鏈消息

### 在源鏈上

1. 用戶（dApp）整理需要跨鏈的消息，整理目標鏈調用的callData
2. dApp調用MOS的transferOut方法，支付跨鏈gas費
3. MOS發送跨鏈交易，彈出跨鏈消息日誌。 您可以在源鏈的瀏覽器上查看交易詳情。

### 在地圖中繼鏈

1. 信使檢測源鏈上的消息日誌，從源鏈上構建證明數據，調用transferIn方法通知中繼鏈上的MOS合約。
2. MOS中繼合約（MAP中繼鏈上的MOS合約）確認源鏈的消息日誌，通過輕客戶端驗證源鏈交易的真實性，判斷是去另一條鏈，發送交易，以及 繼續彈出跨鏈消息日誌。
3.如果MAP中繼鍊是目標鏈，執行call方法，彈出執行日誌。

### 在目標鏈

1. Messenger檢測MAP中繼鏈上的消息日誌，從中繼鏈構建證明數據，調用transferIn方法通知目的鏈上的MOS合約。
2. MOS合約通過輕客戶端驗證MAPO消息日誌的真實性。
3.目的鏈彈出執行日誌，完成消息跨鏈合約調用。

## 流架構

![MAPO 服務消息](croosChainMessage.png)